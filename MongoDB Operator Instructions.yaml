# Setup 01: Ops Manager running outise Kubernetes

# Kubernetes Operator Install

1. Clone the MongoDB Kubernetes Operator git repository
   a. git clone https://github.com/mongodb/mongodb-enterprise-kubernetes.git :

2. Install the CRDs(Custom Resource Definitions), it allows Kubernetes to understand Custome Objects like MongoDB OpsManager
   a. kubectl create namespace mongodb :
   b. kubectl apply -f mongodb-enterprise-kubernetes/crds.yaml :
   c. kubectl get crd : # Verify CRDs are installed

3. Install the Operator
   a. kubectl apply -f mongodb-enterprise-kubernetes/mongodb-enterprise.yaml :
   b. kubectl get pods : # verify Operator pod is running 

4. Create a Config Map
   a. Create a config Map YAML Specification, see a sample one below:

    {
    ---
    apiVersion: v1
    kind: ConfigMap
    metadata:
        name: kube-config
        namespace: mongodb
    data:
        projectName: kubeorg # Project Name that gets Created when deployment MongoDB Resource
        orgId: 5f2c40ea25825d0071e6adbd
        baseUrl: http://ec2-13-234-204-184.ap-south-1.compute.amazonaws.com:81 # Ops Manager URL
    }

   b. kubectl apply -f kube-config.yaml :
   c. kubectl get configmap :

5. Create API Secret
   a. Sample Secret file :

    {    
        ---
        apiVersion: v1
        kind: Secret
        metadata:
            name: opsmgr-credentials
            namespace: mongodb
        stringData:
            user: QHZFJYXE
            publicApiKey: 474cf6ae-e915-4b7e-bde9-3f7c72e91211
    }

   b. kubectl apply -f opsmgr-credentials.yaml :

6. Deploy a MongoDB Replica-Set
   a. Sample MongoDB replica-Set :

    {
        ---
        apiVersion: mongodb.com/v1
        kind: MongoDB
        metadata:
          name: my-replica
        spec:
          members: 1
          #Test Comment
          version: 4.2.1-ent
          opsManager:
            configMapRef:
            name: kube-config
          credentials: opsmgr-credentials
          type: ReplicaSet
          persistent: true   
    }

   b. kubectl apply -f my-replica.yaml :
   c. kubectl get mdb : # To view the MongoDB Objects 
   d. kubectl get pods : # To view the replica-set Pods        

   
